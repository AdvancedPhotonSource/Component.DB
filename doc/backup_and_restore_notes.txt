#
# All commands relative to CDB_ROOT_DIR
# Deployment files are in the etc directory, named using database name. 
# For example:
#   etc/cdb.deploy.conf describes deployment of "cdb" database/webapp
#   etc/cdb_prd.deploy.conf describes deployment of "cdb_prd" database/webapp
# 

#
# Backup DB (1st argument) and web app into specific backup directory (2nd argument)
./sbin/cdb_backup_all.sh cdb backup/prd/cdb.all.20140507
#

#
# Alternatively, one can backup only the db.
# Backup DB (1st argument) into specific backup directory (2nd argument)
# ./sbin/cdb_backup_db.sh cdb backup/prd/cdb.db.20140507
#

#
# Edit or remove populate files in the db backup directory. For example,
# if setting_type table changed, copy new populate_setting_type.sql file from db/sql/cdb into
# the db backup directory, and remove populate_user_setting.sql file from the
# db backup directory. Note that this will result in user settings not being
# preserved.
#

#
# Create new database (1st argument) as the clone of the original, using
# scripts from the db backup dir (2nd argument)
./sbin/cdb_create_db.sh cdb backup/prd/cdb.db.20140507
#

#
# Configure webapp (this needs to be done only the first time particular db is
# instantiated).
#
./sbin/cdb_configure_webapp.sh cdb

# 
# Build software. CdbWebPortal should be in src/java/CdbWebPortal/dist
# directory
#
source setup.sh
make clean
make dist

# 
# Deploy webapp
#
./sbin/cdb_deploy_webapp.sh cdb

